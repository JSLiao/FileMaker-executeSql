<!DOCTYPE html><html lang='en'>  <head>    <meta charset='UTF-8' />    <meta aceVersion='v1.4.14' frameVersion='v1' />    <meta http-equiv='X-UA-Compatible' content='IE=edge' />    <meta name='viewport' content='width=device-width, initial-scale=1.0' />    <title>debug, error message</title>    <style>:root {  font-family: 'times new roman', helvetica, 'songti TC', monaco, 'SF Pro';  font-size: 16px;  background-color: #111;  margin: 0;  padding: 0;  color: #eee;  hyphens: auto;--background_th: #333;}#main-subject {  font-size: 1.2rem;  background-color: rgba(45, 45, 45, 0.6);  color: white;  /* display:inline-block; */  position: fixed;  left: 6px;  top: 6px;  padding: 6px 3px;  align-content: flex-start;  text-decoration: none;  width: 97%;  margin: 0;  box-shadow: 2px 2px 6px 2px rgba(0, 0, 0, 0.7);  box-sizing: border-box;  border-radius: 3px;}/* btn toEdit, tsToTc */#btn-toEdit, #btn-tsToTc {  font-size: 1.2rem;  background-color: rgba(45, 45, 45, 0.6);  color: white;  margin: 0;  box-shadow: 2px 2px 6px 2px rgba(0, 0, 0, 0.7);  box-sizing: border-box;  border-radius: 16px;  cursor:pointer;  align-content: flex-start;}/* btn toEdit */#btn-toEdit {  right: 6px;  top: 6px;  padding: 6px 3px;  text-align: center; /* 文字居中 */  width: 32px;  position: fixed;}/* btn tsToTc */#btn-tsToTc {  right: 44px;  top: 6px;  padding: 6px 3px;  text-align: center; /* 文字居中 */  width: 64px;  position: fixed;}#main-subject:hover,#btn-toEdit:hover,#btn-tsToTc:hover {  background-color: rgba(45, 45, 45, 0.9);  color: #c0edfe;}#main-subject:active,#btn-toEdit:active,#btn-tsToTc:active {  background-color: rgb(255, 145, 45);  color: #c0edfe;}.subNote {  right:20px;  text-align: right;  font-size: 0.9rem;  color: lightGray;}content {  color: lightgray;}p {  color: #ddd;  font-size: 1rem;  height: auto;  padding: 0rem;  margin-block-start: 0.5rem;  margin-block-end: 0.5rem;}hr {  color: #666;  height: 0.5px;}a {  border: none;  color: #ff5;  height: 100%;  text-decoration: none;}a:hover {  color: #fa3;}a:hover:after {  left: auto;  right: 0;  width: 100%;}a:active {  top: 2px;}/* table 样式 */table {  border-top: 1px solid #ccc;  border-left: 1px solid #ccc;}table td,table th {  border-bottom: 1px solid #ccc;  border-right: 1px solid #ccc;  padding: 3px 5px;}table th { background-color: var(--background_th) !important;  border-bottom: 2px solid #ccc;  text-align: center;}/* blockquote 样式 */blockquote {  display: block;  border-left: 5px solid #d0e5f2;  padding: 3px 5px;  margin: 6px 0;  line-height: 1.4;  font-size: 100%;  background-color: #f1f1f1;}/* code 样式 */code {  display: inline-block;  *display: inline;  *zoom: 1;  color: lightgray;  background-color: #fff3;  border-radius: 1px;  padding: 1px 3px;  margin: 0 1px;  font-size: 0.9rem;  font-family: monaco 'robot mono' mono !important;}pre code {  display: block;}/* ul ol 样式 */ul,ol {  margin-left: 8px;  padding-left:4px;  padding-right: 0;}li{  margin-left:0;  padding-left:0px;}ul li{  list-style-type: disc;}ol lit{  list-style-type: decimal;}.sectionTitle {  font-size: 1.2rem;}.preCodecontianer {  background-color: #fff1;}.cssDefault {  font-size: 0.9rem;  color: gray;  margin-left: 1rem;}footer {  text-align: right;  padding: 1px 12px;  margin:1px;  background-color: #8882;  color: lightgray;  bottom:8px;  right:24px;  position:fixed;  z-index: 1;}h1{  font-size:24px;}h2{  font-size:22px;}h3{  font-size:20px;}h4{  font-size:18px;}h5{  font-size:16px;}font[size='1']{  font-size:12px;  padding: 0.1em;  margin: 0.1em;}font[size='2']{  font-size:14px;  padding: 0.1em;  margin: 0.1em;}font[size='3']{  font-size:16px;  padding: 0.1em;  margin: 0.1em;}font[size='4']{  font-size:18px;  padding: 0.1em;  margin: 0.1em;}font[size='5']{  font-size:20px;  padding: 0.1em;  margin: 0.1em;}font[size='6']{  font-size:22px;  padding: 0.1em;  margin: 0.1em;}font[size='7']{  font-size:24px;  padding: 0.2em;}blockquote, blockquote p{  background:#0003 !important;}blockquote, blockquote p{  background:transparent !important;}/* width */::-webkit-scrollbar {width: 12px;}/* Track */::-webkit-scrollbar-track {background: #333;}/* Handle */::-webkit-scrollbar-thumb {background: #345;}/* Handle on hover */::-webkit-scrollbar-thumb:hover {background: #357;}</style>    <style>:root {  margin: 0;  padding: 0;  font-family: 'times new roman', helvetica, 'songti TC', monaco, 'SF Pro';  --background: #111;  --color: #ddd;  --font-size: 16px;  --background_th: #555;  --color-a: #ff5;  --color-a-hover: #fa3;  --background-blockquote: #00e9;  --font-size-code: 14px;  --background-code: #fff3;  background-color: var(--background);  color: var(--color);  font-size: var(--font-size);}.notesView{  background-color: #0308;  margin:0;  padding:8px 2px 8px 16px;}.codeView{  background-color: #0038;  margin:0;  padding:8px 2px 8px 16px;}.resultView{  background-color: #3008;  margin:0;  padding:8px 2px 8px 16px;}.code, .result{  font-family: monaco, monospace;  font-size:13px;  color:var(--color);}</style>  </head>  <body>    <!--完整檢視才顯示, begin-->    <div class='notesView'>      <p id='main-subject'>debug, error message</p>      <br><br><div class='content'><p>當 executeSql 取得返回值 “?” , 表示:計算式內容有錯誤,&nbsp;</p><p>但不會中斷計算, 後續的計算內容會把 executeSql 取得值當作是 “?”, 繼續計算</p><p>除錯方法可參考以下</p><p>修改計算式前, 先做備份</p><ol><li>把計算式放到 Data Viewer 的 expression 區域, 讓它<span style="color: var(--color); background-color: var(--background); font-size: var(--font-size);">執行</span></li><li>在 result 區域會顯示 “?”</li><li>點選 Monitor( 不要清除計算式內容), 讓 data viewer 離開 edit expression 的狀態</li><li>重新點選計算式, 回到 edit expression 狀態</li><li>在 result 區域, 會顯示錯誤訊息字串</li><li>參考訊息, 修正計算式內容</li><li>一次只提供一個訊息, 計算式內容如有多個錯誤, 可能需要重複步驟 2 ~ 5 數次</li></ol><p>補充</p><p>如果 executeSql 只是計算的一行, 也可以使用這個方法</p><p>在 data viewer 同時存在計算式內容會互相影響執行效率, 如果實際狀況允許, 只保持一個運算式在測試中</p><p>打開的 data viewer, 也會影響資料庫的運行數度</p><hr/><p>當”?”不再出現, 不表示這個計算式是沒問題的, 可能</p><ul><li>存在邏輯性錯誤</li><li>可能執行效率太差</li><li>有可能存在缺失, 有偶發性的錯誤</li></ul><p>透過練習, 減少這個部分發生的機率</p><p>實際案例:&nbsp;</p><p>用不同的計算式內容, 取得相同數據, 最快和最慢的執行效率差了40 倍,&nbsp;</p><p>如果看不懂, 沒關係, 後面會寫相關的內容</p><h3><hr/><p><a target="_blank" href="https://deskspace.com/fql_errors_filemaker1.html" style="font-size: 18.72px;">executeSql 錯誤訊息列表</a><br/></p></h3><ul><li><font size="3">There is an error in the syntax of the query.</font></li><li><font size="3">The table named "0" does not exist.</font></li><li><font size="3">The table named "0" already exists in this query.</font></li><li><font size="3">The query is too complex. The maximum number of tables has been exceeded.</font></li><li><font size="3">Expressions involving aggregations are not supported.</font></li><li><font size="3">The column named "0" appears in more than one table in the column reference's scope.</font></li><li><font size="3">The column named "0" does not exist in any table in the column reference's scope.</font></li><li><font size="3">The table named "0" does not exist in the column reference's scope.</font></li><li><font size="3">The column named "1" does not exist in table "0".</font></li><li><font size="3">The literal value "0" is not a valid DATE, TIME or TIMESTAMP.</font></li><li><font size="3">Predicate must contain a logical operation (=, &lt;, OR, AND, IS NULL, ...).</font></li><li><font size="3">The ordinal reference "0" in the ORDER BY clause is not valid.</font></li><li><font size="3">Incompatible types in assignment.</font></li><li><font size="3">The number of values in a VALUES row value constructor does not match the number of values in the target.</font></li><li><font size="3">The number of values in an INSERT...SELECT statement does not match the number of values in the target.</font></li><li><font size="3">A subquery contains an illegal outer reference to a column in the INSERT's target table.</font></li><li><font size="3">An expression contains data types that cannot be compared.</font></li><li><font size="3">An expression contains incompatible data types.</font></li><li><font size="3">The result data type of a CASE expression cannot be inferred; they are all NULL.</font></li><li><font size="3">An invalid number of parameters was supplied to the function "0".</font></li><li><font size="3">Parameter number 0 to the function "1" is not of the correct type.</font></li><li><font size="3">A subquery expression must have exactly one value in the SELECT list.</font></li><li><font size="3">A CAST expression requested an invalid data type conversion</font></li><li><font size="3">A reference to ROWID must be qualified if more than one table is present in the query.</font></li><li><font size="3">All non-aggregated column references in the SELECT list and HAVING clause must be in the GROUP BY clause.</font></li><li><font size="3">The number of columns in both inputs to a UNION operation must be the same.</font></li><li><font size="3">The data types of corresponding columns in the inputs to a UNION operation must be the same.</font></li><li><font size="3">Field repetitions must be numeric and between 1 and 0.</font></li><li><font size="3">A field repetition in the SET clause of an UPDATE statement must be a constant.</font></li><li><font size="3">"0" is an invalid function.</font></li><li><font size="3">The the parameter's type cannot be inferred in this context. At least one query parameter must be an expression, a column or a constant.</font></li><li><font size="3">A query may contain either named parameters or dynamic parameters, but not both.</font></li><li><font size="3">Column names in FROM clause subqueries must be unique.</font></li><li><font size="3">The number of output columns in a FROM clause subquery must match the number of columns in the table's name list.</font></li><li><font size="3">Cursor support is not enabled for this query.</font></li><li><font size="3">A cursor with the name "0" already exists.</font></li><li><font size="3">There is no cursor with the name "0".</font></li><li><font size="3">The cursor "0" is already open.</font></li><li><font size="3">The cursor "0" is not open.</font></li><li><font size="3">The target cursor "0" does not reference a query that is valid for WHERE CURRENT OF .</font></li><li><font size="3">The target cursor "0" does not reference the same table as the current statement.</font></li><li><font size="3">The default value for column "0" does not match the column's data type.</font></li><li><font size="3">The string "0" is not a valid stream name.</font></li><li><font size="3">The column "0" is not valid in this context. The targets of GETAS and PUTAS must be Container fields.</font></li><li><font size="3">The value 0 is not a valid binary string.</font></li><li><font size="3">Container fields are not allowed in UNION DISTINCT queries.</font></li><li><font size="3">The database schema has changed. This prepared query is no longer valid.</font></li><li><font size="3">This statement contains an invalid operation on FileMaker system table "0".</font></li><li><font size="3">Aggregation expressions are not allowed in the WHERE clause.</font></li><li><font size="3">The offset count in OFFSET clause is not valid..</font></li><li><font size="3">The FETCH ... WITH TIES clause is not allowed without a corresponding ORDER BY clause.</font></li><li><font size="3">The fetch count in FETCH clause is not valid.</font></li></ul><hr/><p>改善執行效率</p><p>executeSql 執行的速度很快, 但是也有慢得讓人受不了的時候</p><p>如果速度很慢, 檢查</p><ul><li>是否有無效, 或多餘的敘述</li><li>是否有使用 aggregate function</li><li>是否有使用 sub-query</li><li>From 子句放了不需要的 table</li><li>要取回的數據太大</li></ul><p>可能的改善方法</p><ul><li>檢查函數, 去除不必要的敘述</li><li>縮小取值的範圍</li><li>可以不用 aggregate function ?</li><li>是否有使用 sub-query ?</li><li>移除From 子句中不需要的 table</li><li>利用 Let 函數分割計算式, 減少同一時間的運算所需要處理的資料量</li><li>通常愈短的計算式內容執行效率比較高</li><li>只用一個 executeSql 計算式, 不見得是運算效率最佳的</li></ul><hr/><p><span style="color: var(--color); background-color: var(--background);">取得執行時間的方法</span><br/></p><code>let (</code><div><code>&nbsp;[&nbsp;</code><div><code>&nbsp;~start = get(CurrentTimeUTCMilliseconds);</code></div><div><code>&nbsp;~data = 要取得執行時間的計算式;</code></div><div><code>&nbsp;~end = get(CurrentTimeUTCMilliseconds)</code></div><div><code>&nbsp;];&nbsp;</code></div><div><code>&nbsp;getAsTime ( (~end - ~start)/1000)</code></div><div><code>)</code><div></div></div></div></div>    </div>    <div class='codeView'><p class='codeViewTitle'>計算式:</p><pre class='code'>/*列出業績大於 50000 的員工, 和業績耗時: 27.742 秒檢查是哪裡出問題*/ExecuteSQL("  Select     ( Select employee.name From employee Where sell.salesRep = employee.id),     sum ( sellItem.item_unitPrice * sellItem.item_qty)    From sellItem, employee  Join sell On sellItem.idf = sell.id  Where sell.salesRep = employee.id  Group By sell.salesRep  Having sum ( sellItem.item_unitPrice * sellItem.item_qty) &gt;= 50000  "; ""; "")</pre></div><div class='resultView'><p class='resultViewTitle'>計算結果:</p><pre class='result'>陸非建,50745阮禍,62160曹玄比,64275陳力增,54600袁嘯,62040董素感,52800</pre></div><div class='codeView'><p class='codeViewTitle'>計算式:</p><pre class='code'>/*列出業績大於 50000 的員工, 和業績耗時: 19.981 秒而且業績低於50000 也被列檢查是哪裡出問題*/ExecuteSQL("  Select     ( Select employee.name From employee Where sell.salesRep = employee.id),     sum ( sellItem.item_unitPrice * sellItem.item_qty)    From sellItem, employee  Join sell On sellItem.idf = sell.id  Group By sell.salesRep  Having sum ( sellItem.item_unitPrice * sellItem.item_qty) &gt;= 50000  "; ""; "")</pre></div><div class='resultView'><p class='resultViewTitle'>計算結果:</p><pre class='result'>陸非建,456705馬照貽,201555蕭軻車,448335施既,208305阮禍,559440曹玄比,578475陳力增,491400袁嘯,558360董素感,475200</pre></div><div class='codeView'><p class='codeViewTitle'>計算式:</p><pre class='code'>/*列出業績大於 50000 的員工, 和業績耗時: 2.264 秒*/ExecuteSQL("  Select     ( Select employee.name From employee Where sell.salesRep = employee.id),     sum ( sellItem.item_unitPrice * sellItem.item_qty)    From sellItem  Join sell On sellItem.idf = sell.id  Group By sell.salesRep  Having sum ( sellItem.item_unitPrice * sellItem.item_qty) &gt;= 50000  "; ""; "")</pre></div><div class='resultView'><p class='resultViewTitle'>計算結果:</p><pre class='result'>陸非建,50745阮禍,62160曹玄比,64275陳力增,54600袁嘯,62040董素感,52800</pre></div><div class='codeView'><p class='codeViewTitle'>計算式:</p><pre class='code'>/*列出業績大於 50000 的員工, 和業績用 FileMaker 的函數和 executeSql 組合的計算式, 取得相同結果耗時: 0.695 秒*/while (  [    ~check = 50000 ;    ~employees = executeSql ( "Select name, id From employee Order By id" ; "" ; "");    ~end = valueCount (~employees);    ~i = 1;    ~calc = ""  ];  ~i &lt;= ~end ;  [    ~employee = getValue ( ~employees ; ~i);    // cf_strByDiv ( _text ; _div ; _ifCaseSensitive ; _nth )    ~name = cf_strByDiv ( ~employee ; "," ; 1 ; 1 );    ~employeeId = cf_strByDiv ( ~employee ; "," ; 1 ; 2 );    ~sellIds = executeSql ( "Select id From Sell Where SalesRep = ?"; ""; ""; ~employeeId);    ~sellIds = "'" & substitute ( ~sellIds ; ¶ ; "','") & "'" ;    ~revenue = executeSql ( "Select Sum ( item_qty * item_unitPrice) From sellItem Where idF In (" & ~sellIds & ")" ; ""; "");    ~calc = ~calc & if ( ~revenue &gt; ~check ; ~name & "," & ~revenue & ¶ ; ~calc );    ~i = ~i + 1  ];  uniqueValues (~calc))</pre></div><div class='resultView'><p class='resultViewTitle'>計算結果:</p><pre class='result'>陸非建,50745阮禍,62160曹玄比,64275陳力增,54600袁嘯,62040董素感,52800</pre></div><div class='codeView'><p class='codeViewTitle'>計算式:</p><pre class='code'>// 取得計算式花費時間let (  [    ~start = get(CurrentTimeUTCMilliseconds);    ~data =       while (        [          ~check = 50000 ;          ~employees = executeSql ( "Select name, id From employee Order By id" ; "" ; "");          ~end = valueCount (~employees);          ~i = 1;          ~calc = ""        ];        ~i &lt;= ~end ;        [          ~employee = getValue ( ~employees ; ~i);          // cf_strByDiv ( _text ; _div ; _ifCaseSensitive ; _nth )          ~name = cf_strByDiv ( ~employee ; "," ; 1 ; 1 );          ~employeeId = cf_strByDiv ( ~employee ; "," ; 1 ; 2 );          ~sellIds = executeSql ( "Select id From Sell Where SalesRep = ?"; ""; ""; ~employeeId);          ~sellIds = "'" & substitute ( ~sellIds ; ¶ ; "','") & "'" ;          ~revenue = executeSql ( "Select Sum ( item_qty * item_unitPrice) From sellItem Where idF In (" & ~sellIds & ")" ; ""; "");          ~calc = ~calc & if ( ~revenue &gt; ~check ; ~name & "," & ~revenue & ¶ ; ~calc );          ~i = ~i + 1        ];        uniqueValues (~calc)    );    ~end = get(CurrentTimeUTCMilliseconds)  ];  getAsTime ( (~end - ~start)/1000))</pre></div><div class='resultView'><p class='resultViewTitle'>計算結果:</p><pre class='result'>00:00:00.727</pre></div>    <footer><p>update: 2022/06/06 20:02:03 by: Jeff</p><a class='repo' href='https://github.com/JSLiao/FileMaker-executeSql' target='_blank'>repository</a></footer>    <script></script>  </body></html>