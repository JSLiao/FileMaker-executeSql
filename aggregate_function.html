<!DOCTYPE html><html lang='en'>  <head>    <meta charset='UTF-8' />    <meta aceVersion='v1.4.14' frameVersion='v1' />    <meta http-equiv='X-UA-Compatible' content='IE=edge' />    <meta name='viewport' content='width=device-width, initial-scale=1.0' />    <title>aggregate function</title>    <style>:root {  font-family: 'times new roman', helvetica, 'songti TC', monaco, 'SF Pro';  font-size: 16px;  background-color: #111;  margin: 0;  padding: 0;  color: #eee;  hyphens: auto;--background_th: #333;}#main-subject {  font-size: 1.2rem;  background-color: rgba(45, 45, 45, 0.6);  color: white;  /* display:inline-block; */  position: fixed;  left: 6px;  top: 6px;  padding: 6px 3px;  align-content: flex-start;  text-decoration: none;  width: 97%;  margin: 0;  box-shadow: 2px 2px 6px 2px rgba(0, 0, 0, 0.7);  box-sizing: border-box;  border-radius: 3px;}/* btn toEdit, tsToTc */#btn-toEdit, #btn-tsToTc {  font-size: 1.2rem;  background-color: rgba(45, 45, 45, 0.6);  color: white;  margin: 0;  box-shadow: 2px 2px 6px 2px rgba(0, 0, 0, 0.7);  box-sizing: border-box;  border-radius: 16px;  cursor:pointer;  align-content: flex-start;}/* btn toEdit */#btn-toEdit {  right: 6px;  top: 6px;  padding: 6px 3px;  text-align: center; /* 文字居中 */  width: 32px;  position: fixed;}/* btn tsToTc */#btn-tsToTc {  right: 44px;  top: 6px;  padding: 6px 3px;  text-align: center; /* 文字居中 */  width: 64px;  position: fixed;}#main-subject:hover,#btn-toEdit:hover,#btn-tsToTc:hover {  background-color: rgba(45, 45, 45, 0.9);  color: #c0edfe;}#main-subject:active,#btn-toEdit:active,#btn-tsToTc:active {  background-color: rgb(255, 145, 45);  color: #c0edfe;}.subNote {  right:20px;  text-align: right;  font-size: 0.9rem;  color: lightGray;}content {  color: lightgray;}p {  color: #ddd;  font-size: 1rem;  height: auto;  padding: 0rem;  margin-block-start: 0.5rem;  margin-block-end: 0.5rem;}hr {  color: #666;  height: 0.5px;}a {  border: none;  color: #ff5;  height: 100%;  text-decoration: none;}a:hover {  color: #fa3;}a:hover:after {  left: auto;  right: 0;  width: 100%;}a:active {  top: 2px;}/* table 样式 */table {  border-top: 1px solid #ccc;  border-left: 1px solid #ccc;}table td,table th {  border-bottom: 1px solid #ccc;  border-right: 1px solid #ccc;  padding: 3px 5px;}table th { background-color: var(--background_th) !important;  border-bottom: 2px solid #ccc;  text-align: center;}/* blockquote 样式 */blockquote {  display: block;  border-left: 5px solid #d0e5f2;  padding: 3px 5px;  margin: 6px 0;  line-height: 1.4;  font-size: 100%;  background-color: #f1f1f1;}/* code 样式 */code {  display: inline-block;  *display: inline;  *zoom: 1;  color: lightgray;  background-color: #fff3;  border-radius: 1px;  padding: 1px 3px;  margin: 0 1px;  font-size: 0.9rem;  font-family: monaco 'robot mono' mono !important;}pre code {  display: block;}/* ul ol 样式 */ul,ol {  margin-left: 8px;  padding-left:4px;  padding-right: 0;}li{  margin-left:0;  padding-left:0px;}ul li{  list-style-type: disc;}ol lit{  list-style-type: decimal;}.sectionTitle {  font-size: 1.2rem;}.preCodecontianer {  background-color: #fff1;}.cssDefault {  font-size: 0.9rem;  color: gray;  margin-left: 1rem;}footer {  text-align: right;  padding: 1px 12px;  margin:1px;  background-color: #8882;  color: lightgray;  bottom:8px;  right:24px;  position:fixed;  z-index: 1;}h1{  font-size:24px;}h2{  font-size:22px;}h3{  font-size:20px;}h4{  font-size:18px;}h5{  font-size:16px;}font[size='1']{  font-size:12px;  padding: 0.1em;  margin: 0.1em;}font[size='2']{  font-size:14px;  padding: 0.1em;  margin: 0.1em;}font[size='3']{  font-size:16px;  padding: 0.1em;  margin: 0.1em;}font[size='4']{  font-size:18px;  padding: 0.1em;  margin: 0.1em;}font[size='5']{  font-size:20px;  padding: 0.1em;  margin: 0.1em;}font[size='6']{  font-size:22px;  padding: 0.1em;  margin: 0.1em;}font[size='7']{  font-size:24px;  padding: 0.2em;}blockquote, blockquote p{  background:#0003 !important;}blockquote, blockquote p{  background:transparent !important;}/* width */::-webkit-scrollbar {width: 12px;}/* Track */::-webkit-scrollbar-track {background: #333;}/* Handle */::-webkit-scrollbar-thumb {background: #345;}/* Handle on hover */::-webkit-scrollbar-thumb:hover {background: #357;}</style>    <style>:root {  margin: 0;  padding: 0;  font-family: 'times new roman', helvetica, 'songti TC', monaco, 'SF Pro';  --background: #111;  --color: #ddd;  --font-size: 16px;  --background_th: #555;  --color-a: #ff5;  --color-a-hover: #fa3;  --background-blockquote: #00e9;  --font-size-code: 14px;  --background-code: #fff3;  background-color: var(--background);  color: var(--color);  font-size: var(--font-size);}.notesView{  background-color: #0308;  margin:0;  padding:8px 2px 8px 16px;}.codeView{  background-color: #0038;  margin:0;  padding:8px 2px 8px 16px;}.resultView{  background-color: #3008;  margin:0;  padding:8px 2px 8px 16px;}.code, .result{  font-family: monaco, monospace;  font-size:13px;  color:var(--color);}</style>  </head>  <body>    <!--完整檢視才顯示, begin-->    <div class='notesView'>      <p id='main-subject'>aggregate function</p>      <br><br><div class='content'><p>聚合函數</p><table><thead><tr><th>聚合函數</th><th>說明</th></tr></thead><tbody><tr><td>Count(*)</td><td>計算個數函數</td></tr><tr><td>Count(欄位名稱)</td><td>計算該欄位名稱之不具NULL值的個數</td></tr><tr><td>Avg(欄位名稱)</td><td>計算平均函數</td></tr><tr><td>Sum(欄位名稱)</td><td>計算總合函數</td></tr><tr><td>Max(欄位名稱)</td><td>計算最大值函數</td></tr><tr><td>Min(欄位名稱)</td><td>計算最小值函數</td></tr></tbody></table><p><font color="#eeece0"><span style="caret-color: rgb(238, 236, 224);">aggregate 的使用表示耗時, 在同一個 executeSql 計算式中不要過份使用 aggregate</span></font><br/></p><p><font color="#eeece0"><span style="background-color: var(--background);">aggregate 函數會隨著資料量變大而使得計算更秏時</span><br/></font></p><p><font color="#eeece0">文字, 日期, 時間, 時間戳欄位可以做 Max, Min 運算; 但不能做 Avg運算</font></p><p><font color="#eeece0">aggregate function 不可以當作其他函數計算的引數, 否則會發生 error 8309&nbsp;(“Expressions involving aggregations are not supported”)<br/></font></p><p><font color="#eeece0">aggregate function 可以把數值函數的計算當作引數<br/></font></p><p><span style="caret-color: rgb(249, 150, 59);"><font color="#eeece0">每個 table 都有一個內建的欄位 rowId, 相當於 get( recordId ), 如果要計算紀錄的筆數, &nbsp;Count( rowId ) 絕對不會遇到空資料的狀況</font></span></p><p>aggregate function 不可和 Order by 一起使用</p><p>當 Select 子句同時有不在 aggregate function 的欄位和在 aggregate function 的欄位,&nbsp;不在 aggregate function 的欄位都必須在 Group By 子句出現</p></div>    </div>    <div class='codeView'><p class='codeViewTitle'>計算式:</p><pre class='code'>/* 計算平均年齡age 是 unstored calculation result field花費時間: 6.713 sec*/executeSql("Select Avg(age) From Contact"; "" ; "")</pre></div><div class='resultView'><p class='resultViewTitle'>計算結果:</p><pre class='result'>29.6056765676567657</pre></div><div class='codeView'><p class='codeViewTitle'>計算式:</p><pre class='code'>/*計算各縣市的人數統計 , 再區分女男人數當 Select 子句同時有不在 aggregate function 的欄位和在 aggregate function 的欄位, 不在 aggregate function 的欄位必須在 Group By 子句出現*/
ExecuteSQL("SELECT addrCity, gender, COUNT ( rowId ) FROM contact GROUP BY addrCity , gender" ; "" ; "" )/* 計算各縣市的人數統計
ExecuteSQL ( "SELECT addrCity,addrCity,COUNT ( id ) FROM contact GROUP BY addrCity" ; "" ; "" )
*/

/* 並不是每個人都有英文名字, null 不會被計入
executeSql ( "Select Count(id), Count(nameEng) From Contact Where addrCity = '新北市'"; "" ; "" )
*/</pre></div><div class='resultView'><p class='resultViewTitle'>計算結果:</p><pre class='result'>南投縣,女,725南投縣,男,697台中市,女,725台中市,男,708台北市,女,706台北市,男,695台南市,女,753台南市,男,690台東縣,女,719台東縣,男,715嘉義市,女,646嘉義市,男,703嘉義縣,女,732嘉義縣,男,732基隆市,女,720基隆市,男,719宜蘭縣,女,696宜蘭縣,男,670屏東縣,女,670屏東縣,男,687彰化縣,女,712彰化縣,男,665新北市,女,723新北市,男,662新竹市,女,686新竹市,男,689新竹縣,女,714新竹縣,男,743桃園市,女,661桃園市,男,700澎湖縣,女,783澎湖縣,男,666花蓮縣,女,666花蓮縣,男,716苗栗縣,女,759苗栗縣,男,675連江縣,女,699連江縣,男,707金門縣,女,722金門縣,男,727雲林縣,女,751雲林縣,男,701高雄市,女,331高雄市,男,334</pre></div><div class='codeView'><p class='codeViewTitle'>計算式:</p><pre class='code'>/*計算各縣市的最大年齡
contact 的出生日期是由亂數產生, 果然最大年紀都一樣*/
executeSql("Select addrCity, Max(age) From Contact Group By addrCity"; "" ; "" )</pre></div><div class='resultView'><p class='resultViewTitle'>計算結果:</p><pre class='result'>南投縣,37台中市,37台北市,37台南市,37台東縣,37嘉義市,37嘉義縣,37基隆市,37宜蘭縣,37屏東縣,37彰化縣,37新北市,37新竹市,37新竹縣,37桃園市,37澎湖縣,37花蓮縣,37苗栗縣,37連江縣,37金門縣,37雲林縣,37高雄市,37</pre></div><div class='codeView'><p class='codeViewTitle'>計算式:</p><pre class='code'>/*計算各縣市人口中的最早出生日期
contact 的出生日期是由亂數產生*/
executeSql("Select addrCity, Min(birthday) From Contact Group By addrCity"; "" ; "" )</pre></div><div class='resultView'><p class='resultViewTitle'>計算結果:</p><pre class='result'>南投縣,1985-01-02台中市,1985-01-05台北市,1985-01-04台南市,1985-01-01台東縣,1985-01-02嘉義市,1985-01-04嘉義縣,1985-01-05基隆市,1985-01-14宜蘭縣,1985-01-03屏東縣,1985-01-03彰化縣,1985-01-02新北市,1985-01-01新竹市,1985-01-02新竹縣,1985-01-07桃園市,1985-01-04澎湖縣,1985-01-01花蓮縣,1985-01-04苗栗縣,1985-01-04連江縣,1985-01-01金門縣,1985-01-06雲林縣,1985-01-02高雄市,1985-01-02</pre></div><div class='codeView'><p class='codeViewTitle'>計算式:</p><pre class='code'>/*算出2022/3/30 每一筆銷貨的金額*/executeSql("  Select sellItem.idf, sum(sellItem.item_qty * sellItem.item_unitPrice )   From sellItem, sell  Where sellItem.idf = sell.id And sell.dateSell &gt;= Date '2022/3/30'  Group By idf" ; "" ; "" )/* executeSql 接受 FileMaker 的日期寫法executeSql("  Select sellItem.idf, sum(sellItem.item_qty * sellItem.item_unitPrice )   From sellItem, sell  Where sellItem.idf = sell.id And sell.dateSell &gt;= Date '2022/3/30'  Group By idf" ; "" ; "")*//* 可以使用 ? 和 引數executeSql("  Select sellItem.idf, sum(sellItem.item_qty * sellItem.item_unitPrice )   From sellItem, sell  Where sellItem.idf = sell.id And sell.dateSell &gt;= ?  Group By idf" ; "" ; "" ; Date ( 3 ; 30 ; 2022 ))*/</pre></div><div class='resultView'><p class='resultViewTitle'>計算結果:</p><pre class='result'>0466C63B-CA20-4704-BBB8-C64259ABF769,495235CA588-55C7-427F-B12F-FF8D52CCD7DA,7205FA02815-290B-4FA1-9A07-4B1495408BCB,9608536826D-5425-4DB1-A656-CA442383765E,750CAB3428B-37CD-499C-848F-0F388C3BED00,690F683515D-5C25-4EFF-9356-7095963043FF,1665FDA118C2-0F32-45DA-A1F1-1ACADEB11204,1050</pre></div>    <footer><p>update: 2022/06/18 23:07 by: Jeff</p><a class='repo' href='https://github.com/JSLiao/FileMaker-executeSql' target='_blank'>repository</a></footer>    <script></script>  </body></html>